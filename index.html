<html>
<head>
  
  <title="BaxtonWeb 0.1">
    <link rel="stylesheet" type="text/css" href="index.css">
    </head>

<body>
<div id="mainDiv" align="center">
<image id="icon" src="images/faces/house.png"><br>
  <input type="text" id="DialogueInput"></input>
  <audio id="speechMain"></audio>
  </div>
  <script src="//cdnjs.cloudflare.com/ajax/libs/annyang/2.5.0/annyang.min.js"></script>
<script>
  var voiceType = "baxton";
  var textBox = document.getElementById("DialogueInput");
  function playRandomLine(sounds, voice){
    var dialogueline = sounds[Math.floor(Math.random() * sounds.length)];
    var audio = document.getElementById("speechMain");
    audio.src = ("voicelines/" + voice + "/" + dialogueline);
    audio.play();
  }
  var changeVoiceType = function(voiceName){
      voiceType = voiceName;
   }
    var changeVoiceBaxton = function(){
      voiceType = "baxton";
   }
    
    var changeVoiceWilson = function(){
      voiceType = "wilson";
   }
 var isListening = false;
  var voiceEnabled = false;
  var enableVoice = function(){
     console.log("Initializing speech recognition.");
      var commands = {
          'smith': function(){
            isListening = true;
          },
          'hello': checkInput,
          'hey': checkInput,  
         'hi': checkInput,
        'tell me a joke': checkInput,
        'disable voice': checkInput,
        'goodbye': checkInput,
        'bye': checkInput,
        'change voice to baxton': checkInput,
        'change voice to wilson': checkInput,
};

     // Add our commands to annyang
    annyang.addCommands(commands);
    console.log(commands);
    annyang.init(commands);
    annyang.debug();
    // Start listening. You can call this here, or attach this call to an event, button, etc.
    annyang.start();
    annyang.addCallback('result', function(userSaid, commandText, phrases) {
    if (userSaid[0].toLowerCase() == "smith"){
      console.log(userSaid[0]);
      isListening = true;
    }
    else if (isListening == true){
      checkInput(userSaid[0]);
      console.log(userSaid[0]);
      isListening = false;
    }
    
    });
    annyang.trigger("hello");
  }
  var disableVoice = function(){
    annyang.abort();
  }
  var checkInput = function(value){
    var val = value;
    val = val.toLowerCase();
    try{
    console.log(val);
    var linearray;
    var dialogue = {
      "hello": ["greeting01.mp3", "greeting02.mp3", "greeting03.mp3"],
      "hey": ["greeting01.mp3", "greeting02.mp3", "greeting03.mp3"],
      "hi": ["greeting01.mp3", "greeting02.mp3", "greeting03.mp3"],
      "tell me a joke": ["joke01.mp3", "joke02.mp3", "joke03.mp3", "joke04.mp3", "joke05.mp3", "joke06.mp3"],
      "enable voice": ["hearme.mp3"],
      "disable voice": ["okay.mp3"],
      "change voice to baxton": ["changevoice.mp3"],
      "change voice to wilson": ["changevoice.mp3"],
      "goodbye": ["goodbye.mp3", "goodbye02.mp3"],
      "bye": ["goodbye.mp3", "goodbye02.mp3"],
      "unknown": ["unknown01.mp3", "unknown02.mp3"]
        }
    var functions = {
      "enable voice": enableVoice,
      "disable voice": disableVoice,
      "change voice to baxton": changeVoiceBaxton,
      "change voice to wilson": changeVoiceWilson,
    }
    if(functions[val]){
      var fname = functions[val];
      console.log(fname);
      if(typeof fname === 'function') {
      fname();
    }
    }
    if(dialogue[val]){
        linearray = dialogue[value];
        console.log(linearray);
    }
    else{
        linearray = dialogue["unknown"];
        console.log(linearray);
    }
    playRandomLine(linearray, voiceType);
    }
    
    catch(e){
       console.log(e);
       playRandomLine(["error.mp3", "error2.mp3", "error3.mp3"], voiceType);
   }
  }
  


  
  textBox.onkeydown = function(e){
   if(e.keyCode == 13){
     checkInput(textBox.value)
   }
};
  textBox.addEventListener("submit", checkInput);
</script>
</body>
</html>
