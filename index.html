<html>
<head>
  
  <title="BaxtonWeb 0.1">
    <link rel="stylesheet" type="text/css" href="index.css">
    </head>

<body>
<div id="mainDiv" align="center">
<image id="icon" src="images/faces/house.png"><br>
  <input type="text" id="DialogueInput"></input>
  <audio id="speechMain"></audio>
  </div>
  <script src="//cdnjs.cloudflare.com/ajax/libs/annyang/2.5.0/annyang.min.js"></script>
<script>
  var voiceType = "wilson";
  var textBox = document.getElementById("DialogueInput");
  function playRandomLine(sounds, voice){
    var dialogueline = sounds[Math.floor(Math.random() * sounds.length)];
    var audio = document.getElementById("speechMain");
    audio.src = ("voicelines/" + voice + "/" + dialogueline);
    audio.play();
  }
  var voiceEnabled = false;
  var enableVoice = function(){
     console.log("Initializing speech recognition.");
     if (annyang) {
      // Let's define our first command. First the text we expect, and then the function it should call
       var commands = {
          '*val': checkInput()
          }
        };

     // Add our commands to annyang
    annyang.addCommands(commands);
    annyang.init(commands);
    // Start listening. You can call this here, or attach this call to an event, button, etc.
    annyang.start();
  }
  var checkInput = function(val){
    try{
    var value = textBox.value;
    console.log(val);
    var linearray;
    var dialogue = {
      "hello": ["greeting01", "greeting02.mp3", "greeting03.mp3"],
      "hey": ["greeting01", "greeting02.mp3", "greeting03.mp3"],
      "hi": ["greeting01", "greeting02.mp3", "greeting03.mp3"],
      "enable voice": ["hearme.mp3"],
      "unknown": ["unknown01.mp3", "unknown02.mp3"]
        }
    var functions = {
      "enable voice": enableVoice
    }
    if(functions[val]){
      var fname = functions[val];
      console.log(fname);
      if(typeof fname === 'function') {
      fname();
    }
    }
    if(dialogue[val]){
        linearray = dialogue[value];
        console.log(linearray);
    }
    else{
        linearray = dialogue["unknown"];
        console.log(linearray);
    }
    playRandomLine(linearray, voiceType);
    }
    
    catch(e){
       console.log(e);
       playRandomLine(["error.mp3", "error2.mp3", "error3.mp3"], voiceType);
   }
  }
  


  
  textBox.onkeydown = function(e){
   if(e.keyCode == 13){
     checkInput(textBox.value)
   }
};
  textBox.addEventListener("submit", checkInput);
</script>
</body>
</html>
