<html>
<head>
  
  <title="BaxtonWeb 0.1">
    <link rel="stylesheet" type="text/css" href="index.css">
    </head>

<body>
<div id="mainDiv" align="center">
  <div id="timer" align="center" style="color:lime"></div>
<image id="icon" src="images/faces/house.png"><br>
  <input type="text" id="DialogueInput"></input>
  <audio id="speechMain"></audio>
  <audio id="alarms"></audio>
  </div>
  <script src='https://code.responsivevoice.org/responsivevoice.js'></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/annyang/2.5.0/annyang.min.js"></script>
  <iframe id="frame01" align="center" width="500px" height="400px" frameBorder="0"></iframe>
<script>
  var voiceType = "baxton";
  var textBox = document.getElementById("DialogueInput");
  function playRandomLine(sounds, voice){
    var dialogueline = sounds[Math.floor(Math.random() * sounds.length)];
    var audio = document.getElementById("speechMain");
    audio.src = ("voicelines/" + voice + "/" + dialogueline);
    audio.play();
  }
  function playRandomTTS(arr){
    responsiveVoice.speak(arr[Math.floor(Math.random() * arr.length)], "UK English Male");
  }
  var timerInstance;
  var selfDestructConfirmed = false;
  function selfDestruct(){
    var icon = document.getElementById("icon");
    var text01 = document.getElementById("timer");
    if(selfDestructConfirmed != true){
   
    icon.src = "images/faces/house_alert.png";

    text01.innerHTML = "THE SELF DESTRUCT FEATURE WILL WIPE ALL USER DATA USED ON THIS PAGE.  PLEASE CONFIRM BY ISSUING THE COMMAND 'confirm self destruct'.  IF YOU WISH TO CANCEL, PLEASE TYPE 'cancel self destruct'."
    text01.style.color = "Red";
    }
    else{
      var alarmAudio = document.getElementById("alarms");
      alarmAudio.src = "sound/alarm01.wav";
      alarmAudio.volume = 0.4;
      alarmAudio.addEventListener("ended", alarmAudio.play);
      alarmAudio.play();
      startTimerSD(2);
    }

  }
  function cancelSelfDestruct(){
    var icon = document.getElementById("icon");
    var text01 = document.getElementById("timer");
    var alarmAudio = document.getElementById("alarms");
    alarmAudio.pause();
    icon.src = "images/faces/house.png";
    text01.innerHTML = ""
    text01.style.color = "Lime";
    clearInterval(timerInstance)
  }
  function playCheckers(){
    var iframe01 = document.getElementById("frame01");
    iframe01.src = "checkers/index.html";
    playRandomTTS(["I'll have you know I'm quite skilled with games of logic.  Perhaps you are better!  We shall see.", "I'd love a game.  Shall we?", "Very good!  I am setting up the game now."]);
  }
  var isSearchingYT = false;
  var go_get = function(){
    var base_url = 'https://www.youtube.com/embed?listType=search&list=';
    var search_field = document.getElementById("DialogueInput").value;
    var target_url = base_url + search_field;
    var ifr = document.getElementById('frame01');
    ifr.src = target_url;
    isSearchingYT = false;
}
  var changeVoiceType = function(voiceName){
      voiceType = voiceName;
   }
    var changeVoiceBaxton = function(){
      voiceType = "baxton";
   }
    
    var changeVoiceWilson = function(){
      voiceType = "wilson";
   }
 var isListening = false;
 var timerDiv = document.getElementById("timer");
 var timerTime = 0;
  var voiceEnabled = false;
  var enableVoice = function(){
     console.log("Initializing speech recognition.");
      var commands = {
          'smith': function(){
            isListening = true;
          },
          'hello': checkInput,
          'hey': checkInput,  
         'hi': checkInput,
        'tell me a joke': checkInput,
        'disable voice': checkInput,
        'goodbye': checkInput,
        'bye': checkInput,
        'set a timer for 1 minute': checkInput,
        'set a timer for 5 minutes': checkInput,
        'set a timer for 10 minutes': checkInput,
        'set a timer for 15 minutes': checkInput,
        'set a timer for 30 minutes': checkInput,
        'set a timer for 45 minutes': checkInput,
        'set a timer for 50 minutes': checkInput,
        'set a timer for 1 hour': checkInput,
        'change voice to baxton': checkInput,
        'change voice to wilson': checkInput,
        'search youtube': go_get,
        'initiate self destruct': checkInput,
        'cancel self destruct': checkInput,
        'confirm self destruct': checkInput,
        'play checkers': playCheckers
};

     // Add our commands to annyang
    annyang.addCommands(commands);
    console.log(commands);
    annyang.init(commands);
    annyang.debug();
    // Start listening. You can call this here, or attach this call to an event, button, etc.
    annyang.start();
    annyang.addCallback('result', function(userSaid, commandText, phrases) {
    if (userSaid[0].toLowerCase() == "smith"){
      console.log(userSaid[0]);
      isListening = true;
    }
    else if (isListening == true){
      checkInput(userSaid[0]);
      console.log(userSaid[0]);
      isListening = false;
    }
    
    });
    annyang.trigger("hello");
  }

  var startTimer = function(time){
    timerTime = time * 60;
    timerInstance = setInterval(countTimer, 1000);
  }
  var countTimer = function(){
    if(timerTime > 0){
      timerTime = timerTime - 1;
      timerDiv.innerHTML = timerTime.toString();
      var audioTick = new Audio("sound/tick1.wav");
      //audioTick.play();
    }
    else{
     var audioTimer = new Audio("sound/timerEnd.mp3");
     audioTimer.play();
     clearInterval(timerInstance);
    }
  }
  var startTimerSD = function(time){
    timerTime = time * 60;
    timerInstance = setInterval(countTimerSD, 1000);
  }
  var countTimerSD = function(){
    if(timerTime == 10){
      playRandomLine(["goodbyeSD.mp3"], voiceType);
    }
    if(timerTime > 0){
      timerTime = timerTime - 1;
      timerDiv.innerHTML = timerTime.toString();
      var audioTick = new Audio("sound/tick1.wav");
      //audioTick.play();
    }
    else{
     var audioTimer = new Audio("sound/timerEnd.mp3");
     audioTimer.play();
     clearInterval(timerInstance);
     Window.close();
    }
  }
  var disableVoice = function(){
    annyang.abort();
  }
  var checkInput = function(value){
    var val = value;
    val = val.toLowerCase();
    try{
    console.log(val);
    var linearray;
    var dialogue = {
      "hello": ["greeting01.mp3", "greeting02.mp3", "greeting03.mp3"],
      "hey": ["greeting01.mp3", "greeting02.mp3", "greeting03.mp3"],
      "hi": ["greeting01.mp3", "greeting02.mp3", "greeting03.mp3"],
      "tell me a joke": ["joke01.mp3", "joke02.mp3", "joke03.mp3", "joke04.mp3", "joke05.mp3", "joke06.mp3"],
      "enable voice": ["hearme.mp3"],
      "disable voice": ["okay.mp3"],
      "change voice to baxton": ["changevoice.mp3"],
      "change voice to wilson": ["changevoice.mp3"],
      "goodbye": ["goodbye.mp3", "goodbye02.mp3"],
      "bye": ["goodbye.mp3", "goodbye02.mp3"],
      "set a timer for 1 minute": ["okay.mp3"],
      "set a timer for 5 minutes": ["okay.mp3"],
      "set a timer for 10 minutes": ["okay.mp3"],
      "set a timer for 15 minutes": ["okay.mp3"],
      "set a timer for 30 minutes": ["okay.mp3"],
      "set a timer for 45 minutes": ["okay.mp3"],
      "set a timer for 50 minutes": ["okay.mp3"],
      "set a timer for 1 hour": ["okay.mp3"],
      "search youtube": ["okay.mp3"],
      "initiate self destruct": ["selfdestructconfirmed.mp3"],
      "confirm self destruct": ["selfdestructconfirmed.mp3"],
      "unknown": ["unknown01.mp3", "unknown02.mp3"]
        }
    var dialogueTTS = {
      "hello": ["Hello, sir.  Systems operating at 100% efficiency.", "Good day, sir.  A pleasure to see you again."],
      "hey": ["Hello, sir.  Systems operating at 100% efficiency.", "Good day, sir.  A pleasure to see you again."],
      "hi": ["Hello, sir.  Systems operating at 100% efficiency.", "Good day, sir.  A pleasure to see you again."],
      "unknown": ["I don't understand.", "I beg your pardon?"],
      "enable voice": ["I'm all ears."],
      "disable voice": ["Voice disabled."],
      "set a timer for 1 minute": ["Very good.  Timer set for one minute."],
      "set a timer for 5 minutes": ["Very good.  Timer set for five minutes."],
      "set a timer for 10 minutes": ["Very good.  Timer set for ten minutes."],
      "set a timer for 15 minutes": ["Very good.  Timer set for fifteen minutes."],
      "set a timer for 30 minutes": ["Very good.  Timer set for thirty minutes."],
      "set a timer for 45 minutes": ["Very good.  Timer set for forty five minutes."],
      "set a timer for 50 minutes": ["Very good.  Timer set for fifty minutes."],
      "set a timer for 1 hour": ["Very good.  Timer set for one hour."],
      "search youtube": ["What would you like to search for?"],
      "change voice to baxton": ["Please see this url, doctor holmes dot github dot i o slash web assistant slash voice, to use the pre-recorded voicelines."],
      "initiate self destruct": ["As you wish.  I require secondary confirmation.  Please say the command. confirm self destruct. to continue with the self destruct sequence."],
      "confirm self destruct": ["Very well.  Might I say it was an honor to serve you."],
      "cancel self destruct": ["Might I say I am relieved that we did not have to resort to that.  Thank you."],
      "tell me a joke": ["Arial, papyrus, and comic sans walk into a bar, and the bartender says.  Hey!  We don't serve your type in here.", "If four out of five people suffer from radiation poisoning, does the fifth guy enjoy it?", "Two fish swim into a concrete wall.  One turns to the other and says.  Damn.", "A neutron walks into a bar and asks, how much for a drink.  The bartender replies for you, no charge."],
      "play checkers": ["I'll have you know I'm quite skilled with games of logic.  Perhaps you are better!  We shall see.", "I'd love a game.  Shall we?", "Very good!  I am setting up the game now."]
    }
    var functions = {
      "enable voice": enableVoice,
      "disable voice": disableVoice,
      "set a timer for 1 minute": function(){
        startTimer(1);
      },
      "set a timer for 5 minutes": function(){
        startTimer(5);
      },
      "set a timer for 10 minutes": function(){
        startTimer(10);
      },
      "set a timer for 15 minutes": function(){
        startTimer(15);
      },
      "set a timer for 30 minutes": function(){
        startTimer(30);
      },
      "set a timer for 45 minutes": function(){
        startTimer(45);
      },
      "set a timer for 50 minutes": function(){
        startTimer(50);
      },
      "set a timer for 1 hour": function(){
        startTimer(60);
      },
      "search youtube": function(){
        isSearchingYT = true;
      },
      "initiate self destruct": function(){
        selfDestruct();
        selfDestructConfirmed = true;
        
      },
      "confirm self destruct": function(){
        selfDestruct();  
      },
      "play checkers": function(){
        playCheckers();  
      },
      "cancel self destruct": function(){
        cancelSelfDestruct();
      },
      "change voice to baxton": changeVoiceBaxton,
      "change voice to wilson": changeVoiceWilson,
    }
    if(functions[val]){
      var fname = functions[val];
      console.log(fname);
      if(typeof fname === 'function') {
      fname();
    }
    }
    if(dialogue[val]){
        linearray = dialogueTTS[value];
        
        console.log(linearray);
    }
    else{
        linearray = dialogueTTS["unknown"];
        console.log(linearray);
    }
    playRandomTTS(linearray, voiceType);
    textBox.value = "";
    }
    
    catch(e){
       console.log(e);
       playRandomTTS(["My apologies, but there has been an error.  The error code reads as follows. " + e]);
   }
  }
  


  
  textBox.onkeydown = function(e){
   if(e.keyCode == 13){
     if(isSearchingYT == true){
        go_get();
     }else{
     checkInput(textBox.value);
     }
     }
   }
  textBox.addEventListener("submit", checkInput);
</script>
</body>
</html>
